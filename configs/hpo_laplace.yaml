study:
    name: "laplace_small"
    storage: "sqlite:///optuna_studies/hpo.db"
    direction: "minimize"
    resume: true

budget:
    n_trials: 10                # tiny run on TEST; increase for full HPO

resources:
    partition: "TEST"
    time: "00:55:00"
    mem_gb: 30
    cpus_per_task: 2
    gpus: 1
    conda_env: "thesis_pascal"
    max_parallel: 4

io:
    outputs_root: "outputs/optuna"
    logs_root: "logs"
    job_name_template: "{study}_{ts}"
    trial_dir_template: "trial_{trial:05d}"

base_config:
    train_config_path: "configs/train_laplace.yaml"
    train_script_path: "scripts/train_regression.py"

repro:
    snapshot_hpo_config: true
    snapshot_base_config: true
    save_pip_freeze: false
    save_git_commit: false

pruner:
    name: "median"
    params:
        n_startup_trials: 15

search_space:
    - { name: "training.epochs",      dist: "choice", choices: [25] }
    - { name: "training.lr",          dist: "loguniform", low: 1.0e-4, high: 3.0e-3 }
    - { name: "training.weight_decay",dist: "loguniform", low: 1.0e-6, high: 1.0e-2 }
    - { name: "training.grad_clip",   dist: "uniform", low: 0.0, high: 1.0, step: 0.1 }
    - { name: "model.hidden_dims",    dist: "choice",
        choices: [[256,256,128], [512,256,128], [512,512,256], [768,384,192]] }
    - { name: "model.dropout",        dist: "uniform", low: 0.05, high: 0.30, step: 0.05 }
    - { name: "model.activation",     dist: "choice", choices: ["relu","gelu","tanh"] }
    - { name: "data.batch_size",      dist: "choice", choices: [512, 1024] }

post_run:
    export_best: true
    best_dirname: "best"
    best_filename: "best_hparams.json"
    latest_pointer_dir: "outputs/best_hparams/{study}"
